<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://blog.cnklp.cn/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="in the autumn sky"><meta charset="UTF-8"><title>éƒ¨ç½²Ubuntuç³»ç»Ÿå¹¶é€šè¿‡PXEè¿›è¡Œæ— ç›˜å¯åŠ¨ | Creeper&#39;s blog</title>
<link href="https://blog.cnklp.cn/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://blog.cnklp.cn/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<link rel="canonical" href="https://blog.cnklp.cn/post/2021-04-27-delopy-pxe-ubuntu/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://blog.cnklp.cn"><img alt="logo" style="display:inline-block;" src="https://blog.cnklp.cn/images/avatar.png"/></a><h1 title="Creeper&#39;s blog" class="weaklink"><a  href="/">Creeper&#39;s blog</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1653710788636" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>éƒ¨ç½²Ubuntuç³»ç»Ÿå¹¶é€šè¿‡PXEè¿›è¡Œæ— ç›˜å¯åŠ¨</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2021-04-27</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px"></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">2008å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">9 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<h2 id="å‰è¨€">å‰è¨€</h2>
<p>åœ¨ä¸šä½™æ—¶é—´éƒ¨ç½²å®¢æˆ·éœ€è¦çš„åº”ç”¨ï¼Œå‘ç°æœåŠ¡å™¨ä¸å¤Ÿç”¨äº†ï¼Œçœ‹äº†ä¸€çœ¼æ—©å·²è¢«é—å¼ƒçš„ç¬”ç”µï¼Œæˆ‘çœ¼ä¸­ä¸€äº®ï¼Œå‡†å¤‡å‘æŒ¥æˆ‘çš„ä¼ ç»Ÿè‰ºèƒ½ï¼š<strong>åºŸç‰©åˆ©ç”¨</strong></p>
<h2 id="å‡†å¤‡">å‡†å¤‡</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦å‡†å¤‡å¥½ï¼š</p>
<ul>
<li>ä¸€å°æ”¯æŒPXEçš„è®¾å¤‡ï¼Œä¸€èˆ¬æ¥è¯´åªè¦ä¸æ˜¯å¤ªè¿‡æ—¶ï¼ŒåŸºæœ¬ä¸Šéƒ½æ”¯æŒã€‚</li>
<li>ä¸€å°æ”¯æŒTFTPåŠŸèƒ½çš„DHCPæœåŠ¡å™¨ã€‚</li>
<li>pxelinuxå›ºä»¶</li>
<li>å±€åŸŸç½‘å†…èƒ½æ­£å¸¸è¿è¡Œçš„Debianç³»æœåŠ¡å™¨ï¼ˆåŒ…æ‹¬Ubuntuï¼‰</li>
</ul>
<h2 id="å¼€å§‹éƒ¨ç½²">å¼€å§‹éƒ¨ç½²</h2>
<h3 id="å‡†å¤‡æ— ç›˜ç³»ç»Ÿ">å‡†å¤‡æ— ç›˜ç³»ç»Ÿ</h3>
<p>ç™»å½•è‡ªå·±çš„Debianç±»æœåŠ¡å™¨ï¼Œç¬”è€…ä½¿ç”¨çš„æ˜¯Debian Busterï¼š</p>
<pre><code>Microsoft Windows [;ç‰ˆæœ¬ 10.0.19042.928]
(c) Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

C:\Users\creeper&amp;gt;ssh root@192.168.123.88
root@192.168.123.88's password:
Linux web 4.19.0-14-amd64 #1 SMP Debian 4.19.171-2 (2021-01-30) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Tue Apr 27 12:33:00 2021 from 127.0.0.1
root@web:~#
</code></pre>
<p>æŸ¥çœ‹ç£ç›˜ï¼š</p>
<pre><code>root@web:~# fdisk -l
Disk /dev/sdaï¼š50 GiBï¼Œ53687091200 å­—èŠ‚ï¼Œ104857600 ä¸ªæ‰‡åŒº
Disk model: QEMU HARDDISK
å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚
æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚
I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚
ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šdos
ç£ç›˜æ ‡è¯†ç¬¦ï¼š0xa39d59c3

è®¾å¤‡       å¯åŠ¨      èµ·ç‚¹      æœ«å°¾      æ‰‡åŒº  å¤§å° Id ç±»å‹
/dev/sda1  *         2048 102856703 102854656   49G 83 Linux
/dev/sda2       102858750 104855551   1996802  975M  5 æ‰©å±•
/dev/sda5       102858752 104855551   1996800  975M 82 Linux swap / Solaris
</code></pre>
<p>å¯ä»¥çœ‹è§è¿™ä¸ªVPSåªæœ‰50GBçš„ç¡¬ç›˜ï¼Œå¦‚æœè¦åœ¨è¯¥ç³»ç»Ÿä¸Šéƒ¨ç½²æ— ç›˜æœºæ‰€éœ€è¦çš„æ“ä½œç³»ç»Ÿï¼Œè¿˜åº”è¯¥è€ƒè™‘ç£ç›˜çš„å ç”¨æ˜¯å¦ä¼šå½±å“å·²ç»éƒ¨ç½²çš„æœåŠ¡ï¼Œä¸ºäº†é¿å…æœªæ¥ä¸å¿…è¦çš„ç£ç›˜å ç”¨é—®é¢˜ï¼Œæ­¤å¤„æˆ‘ä½¿ç”¨ç¾¤æ™–NASçš„iSCSIä¸ºVPSæ‰©å®¹ã€‚</p>
<p>å¦‚æœä½ ä¸éœ€è¦æŒ‚è½½iSCSIç£ç›˜ï¼Œè¯·ç›´æ¥è·³è¿‡è¿™ä¸€æ­¥ã€‚</p>
<h3 id="å¯ç”¨ç¾¤æ™–iscsiåŠŸèƒ½å¹¶æŒ‚è½½iscsiè¿œç¨‹ç£ç›˜">å¯ç”¨ç¾¤æ™–iSCSIåŠŸèƒ½å¹¶æŒ‚è½½iSCSIè¿œç¨‹ç£ç›˜</h3>
<p>iSCSIèµ·æºäº2003å¹´çš„IBMå…¬å¸ï¼Œé€šè¿‡TCP/IPåè®®æ¨¡æ‹ŸSCSIæ€»çº¿ä»¥æ–¹ä¾¿å•†ç”¨æœåŠ¡å™¨çš„å¼¹æ€§å­˜å‚¨éƒ¨ç½²ï¼Œè¦æƒ³åœ¨ç¾¤æ™–NASä¸Šå¯ç”¨è¿™ä¸€åŠŸèƒ½ï¼Œé¦–å…ˆç™»å½•NASå¹¶æ‰“å¼€å­˜å‚¨ç©ºé—´ç®¡ç†å‘˜ç¨‹åºï¼š</p>
<figure data-type="image" tabindex="1"><img src="https://blog.cnklp.cn/post-images/1653710308834.png" alt="" loading="lazy"></figure>
<p>å¯ä»¥çœ‹åˆ°æˆ‘çš„iSCSIè®¾å¤‡å·²ç»æ­£å¸¸è¿è¡Œå¹¶ä¸”å·²ç»æœ‰è®¾å¤‡æŒ‚è½½äº†ï¼Œä¸ºäº†æ•™å­¦ï¼Œæˆ‘ä»¬åˆ‡æ¢åˆ°iSCSI Targetæ ‡ç­¾ï¼Œåˆ›å»ºä¸€ä¸ªiSCSIç›®æ ‡ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://blog.cnklp.cn/post-images/1653710333683.png" alt="" loading="lazy"></figure>
<p>åç§°å¤„ï¼ˆçº¢è‰²è¾¹æ¡†ï¼‰å¯ä»¥éšæ„å¡«å†™ã€‚</p>
<p>æ¥ä¸‹æ¥åˆ›å»ºiSCSI LUNï¼Œä¸ºæ–°çš„iSCSIè¿æ¥ç‚¹è®¾ç½®è®¾å¤‡ï¼Œå¯¹äºç¾¤æ™–æ¥è¯´ï¼Œè¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿç£ç›˜ä¾›å…¶ä»–è®¾å¤‡ä½¿ç”¨ï¼š<br>
<img src="https://blog.cnklp.cn/post-images/1653710356582.png" alt="" loading="lazy"><br>
LUNåç§°å¯ä»¥éšæ„å¡«å†™ï¼Œå®¹é‡æˆ‘è®¾ç½®ä¸º50GBï¼Œåœ¨iSCSI Targetä¸‹æ‹‰èœå•å¤„é€‰æ‹©åˆšåˆšåˆ›å»ºçš„Targetã€‚</p>
<p>æˆ‘ä»¬å›åˆ°VPSçš„SSHçª—å£ï¼Œé¦–å…ˆå®‰è£…iSCSIå®¢æˆ·ç«¯ç¨‹åºï¼š</p>
<pre><code>apt install open-iscsi -y
</code></pre>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œç¼–è¾‘æ–‡ä»¶ï¼š</p>
<pre><code>vim /etc/iscsi/iscsid.conf
</code></pre>
<p>åœ¨å¤§çº¦ç¬¬43è¡Œé™„è¿‘æ”¹ä¸ºï¼š</p>
<pre><code>node.startup = automatic
</code></pre>
<p>è®¾ç½®å¥½åiSCSIæœåŠ¡ä¼šä¼´éšç³»ç»Ÿå¯åŠ¨ï¼Œç„¶åå¼€å§‹æœå¯»iSCSIè®¾å¤‡ï¼š</p>
<pre><code>iscsiadm --mode discovery --type sendtargets --portal [Your NAS's IP addr]
</code></pre>
<p>å¦‚æœNASé…ç½®æ— è¯¯ï¼Œä¼šè¿”å›ä¸‹é¢çš„ç»“æœï¼š</p>
<pre><code>192.168.123.154:3260,1 iqn.2000-01.com.synology:PigeonDS.netboot
[fe80::211:32ff:fe88:b001]:3260,1 iqn.2000-01.com.synology:PigeonDS.netboot
192.168.150.128:3260,1 iqn.2000-01.com.synology:PigeonDS.netboot
[fe80::a458:4bff:fe64:d95]:3260,1 iqn.2000-01.com.synology:PigeonDS.netboot
10.8.0.1:3260,1 iqn.2000-01.com.synology:PigeonDS.netboot
</code></pre>
<p>ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿æ¥åˆ°iSCSIæœåŠ¡å™¨ï¼š</p>
<pre><code>iscsiadm --mode node --targetname [;Your IQN] --portal [;Your Nas's IP addr] --login
</code></pre>
<p>ç„¶åæŸ¥çœ‹ç£ç›˜ä¿¡æ¯ï¼š</p>
<pre><code>root@web:~# fdisk -l
Disk /dev/sdaï¼š50 GiBï¼Œ53687091200 å­—èŠ‚ï¼Œ104857600 ä¸ªæ‰‡åŒº
Disk model: QEMU HARDDISK
å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚
æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚
I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚
ç£ç›˜æ ‡ç­¾ç±»å‹ï¼šdos
ç£ç›˜æ ‡è¯†ç¬¦ï¼š0xa39d59c3

è®¾å¤‡       å¯åŠ¨      èµ·ç‚¹      æœ«å°¾      æ‰‡åŒº  å¤§å° Id ç±»å‹
/dev/sda1  *         2048 102856703 102854656   49G 83 Linux
/dev/sda2       102858750 104855551   1996802  975M  5 æ‰©å±•
/dev/sda5       102858752 104855551   1996800  975M 82 Linux swap / Solaris


Disk /dev/sdbï¼š50 GiBï¼Œ53687091200 å­—èŠ‚ï¼Œ104857600 ä¸ªæ‰‡åŒº
Disk model: iSCSI Storage
å•å…ƒï¼šæ‰‡åŒº / 1 * 512 = 512 å­—èŠ‚
æ‰‡åŒºå¤§å°(é€»è¾‘/ç‰©ç†)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚
I/O å¤§å°(æœ€å°/æœ€ä½³)ï¼š512 å­—èŠ‚ / 512 å­—èŠ‚
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå·²ç»èƒ½è®¤å‡ºè¿œç¨‹ç¡¬ç›˜äº†ï¼Œä½†è¿˜éœ€è¦åˆ†åŒºå¹¶æ ¼å¼åŒ–æ‰èƒ½ä½¿ç”¨ï¼š</p>
<pre><code>fdisk /dev/sdb
mkfs.ext4 /dev/sdb
</code></pre>
<p>å®Œæˆä¹‹åè¿˜éœ€è¦ä¿è¯iSCSIåœ¨é‡å¯åèƒ½å¤Ÿè¢«ç³»ç»Ÿè‡ªåŠ¨æŒ‚è½½ï¼Œæˆ‘æ˜¯è¿™æ ·åšçš„ï¼š</p>
<pre><code>mkdir /mnt/iscsi #åˆ›å»ºæŒ‚è½½ç‚¹
tune2fs -l /dev/sdb #æŸ¥çœ‹iSCSIè®¾å¤‡çš„UUID
vi /etc/fstab #å†™å…¥fstab
</code></pre>
<p>å…¶ä¸­fstabæ–‡ä»¶æ·»åŠ ä¸‹åˆ—å†…å®¹ï¼š</p>
<pre><code>UUID=[Your disk's UUID] /mnt/iscsi ext4 _netdev 0 0
</code></pre>
<p>é‡å¯ï¼Œå¤§åŠŸå‘Šæˆï¼</p>
<h3 id="åˆ›å»ºç³»ç»Ÿæ–‡ä»¶">åˆ›å»ºç³»ç»Ÿæ–‡ä»¶</h3>
<p>é¦–å…ˆè¿›å…¥/mnt/iscsiï¼Œè¿™æ˜¯æ¥ä¸‹æ¥çš„å·¥ä½œç›®å½•ã€‚</p>
<p>å®‰è£…å¿…è¦çš„è½¯ä»¶ï¼š</p>
<pre><code>apt install schroot debootstrap -y
</code></pre>
<p>ä¹‹ååˆ›å»ºchrootå®¹å™¨å¿…è¦çš„æ–‡ä»¶ï¼š</p>
<pre><code>debootstrap bionic /mnt/iscsi http://archive.ubuntu.com/ubuntu/
</code></pre>
<p>æ­¤å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªåŸºäºUbuntu server 18.06çš„chrootç³»ç»Ÿï¼Œä¹‹åæˆ‘ä»¬çš„æ— ç›˜æœºä¹Ÿä¼šä»¥è¯¥æ–‡ä»¶ç³»ç»Ÿä¸ºæ ¹ç›®å½•å¯åŠ¨ã€‚</p>
<p>å¦‚æœä¸‹è½½é€Ÿåº¦æ…¢ï¼Œå°è¯•ä½¿ç”¨ä»£ç†ä¸‹è½½ã€‚</p>
<p>å®Œæˆä¹‹åï¼Œè¾“å…¥å‘½ä»¤æ¥åˆ°chrootå®¹å™¨ï¼š</p>
<pre><code>chroot /mnt/iscsi
</code></pre>
<p>åœ¨æ“ä½œå‰ï¼Œåˆ‡æ¢åˆ°TUNAè½¯ä»¶æºï¼š</p>
<pre><code>#å‘/etc/apt/sources.listæ–‡ä»¶å†…å†™å…¥
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic main restricted
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic multiverse
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-update main restricted
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-update universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-update multiverse
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-security main restricted
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-security universe
deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu bionic-security multiverse

</code></pre>
<p>æ‰§è¡Œä¸‹é¢çš„æŒ‡ä»¤ç®€æ˜“åˆå§‹åŒ–æ¥ä¸‹æ¥è¦ç”¨çš„ç³»ç»Ÿï¼š</p>
<pre><code>apt update
apt install openssh-server -y #å®‰è£…SSHæœåŠ¡å™¨ï¼Œè®°å¾—å…è®¸rootèº«ä»½ç™»å½•
passwd root #è®¾ç½®æ–°çš„rootå¯†ç 
hostnamectl set-hostname [Your new hostname] #è®¾ç½®ä¸€ä¸ªæ–°çš„ä¸»æœºåï¼Œä¸ç„¶æ— ç›˜æœºå¯åŠ¨åä¸»æœºåä¸VPSå†²çª
</code></pre>
<p>åˆ›å»ºå¯åŠ¨éœ€è¦çš„å†…æ ¸ï¼Œåœ¨ä¹‹å‰è¯·ç¡®è®¤è½¯ä»¶æºè®¾ç½®æ— è¯¯ã€‚</p>
<pre><code>apt install linux-image-generic

</code></pre>
<figure data-type="image" tabindex="3"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9ibG9nLm1ld3dvb2YuY24vd3AtY29udGVudC91cGxvYWRzLzIwMTkvMDcvaW1hZ2UtNC5wbmc?x-oss-process=image/format,png" alt="" loading="lazy"></figure>
<p>å®‰è£…æ—¶å¯èƒ½é‡åˆ°è¿™æ ·çš„ç•Œé¢ï¼Œæ­¤å¤„é€‰YESï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨GRUBå¼•å¯¼æ“ä½œç³»ç»Ÿã€‚</p>
<p>å®‰è£…å®Œæˆåï¼Œæ‰§è¡Œï¼š</p>
<pre><code>update-initramfs
</code></pre>
<p>è¾“å…¥exité€€å‡ºchrootå®¹å™¨ï¼Œå°†ç”Ÿæˆçš„initrd.imgæ–‡ä»¶æ”¾å¥½å¤‡ç”¨</p>
<p>è‡³æ­¤ï¼Œæ–‡ä»¶ç³»ç»Ÿåˆ›å»ºå®Œæˆã€‚</p>
<h3 id="å‡†å¤‡nfsæœåŠ¡å™¨">å‡†å¤‡NFSæœåŠ¡å™¨</h3>
<p>å®‰è£…NFSæœåŠ¡å™¨ï¼š</p>
<pre><code>apt install nfs-kernel-server -y
</code></pre>
<p>ä¹‹åä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code>vi /etc/exports
</code></pre>
<p>åœ¨æ–‡ä»¶å†…æ·»åŠ ä¸€è¡Œï¼š</p>
<pre><code>/mnt/iscsi *(rw,sync,no_root_squash)
#æ ¼å¼ä¸º /path/to/your/root [ipaddr](rw,sync)ï¼Œå¯è‡ªè¡Œä¿®æ”¹
</code></pre>
<p>é‡å¯NFSæœåŠ¡å™¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯ï¼š</p>
<pre><code>systemctl restart nfs-kernel-server.service
systemctl enable nfs-kernel-server.service
</code></pre>
<h3 id="å‡†å¤‡dhcpæœåŠ¡å™¨">å‡†å¤‡DHCPæœåŠ¡å™¨</h3>
<figure data-type="image" tabindex="4"><img src="https://blog.cnklp.cn/post-images/1653710762667.png" alt="" loading="lazy"></figure>
<p>æˆ‘ä½¿ç”¨çš„æ˜¯åŸºäºåµŒå…¥å¼Linuxçš„Pandavanç³»ç»Ÿè·¯ç”±å™¨ï¼Œdnsmasqå·²ç»é›†æˆäº†TFTPåŠŸèƒ½ï¼Œåœ¨é…ç½®æ–‡ä»¶å¤„å¯ç”¨å³å¯ã€‚</p>
<p>å°†åˆšåˆšç”Ÿæˆçš„å†…æ ¸æ–‡ä»¶å¤åˆ¶åˆ°TFTPæœåŠ¡å™¨çš„è™šæ‹Ÿæ ¹ç›®å½•ã€‚</p>
<p>å°†PXEå›ºä»¶ä¸Šä¼ è‡³è·¯ç”±å™¨ï¼Œå¹¶ä¿®æ”¹pxelinux.cfg/defaultæ–‡ä»¶</p>
<pre><code>DISPLAY boot.txt2 #æ­¤å¤„ä¸ºå¸®åŠ©ä¿¡æ¯ï¼Œå¯å†™å¯ä¸å†™ï¼Œtxtæ–‡ä»¶æ”¾ç½®äºTFTPæ ¹ç›®å½•å¤„
...

DEFAULT linux #é»˜è®¤å¯åŠ¨èœå•

LABEL linux #å¯åŠ¨èœå•
    kernel vmlinuz
    append vga=normal initrd=initrd.img ramdisk_size=14332 root=/dev/nfs nfsroot=[;Your NFS server's ip addr]:/mnt/iscsi rw -- #æ­¤å¤„ä¸ºå¼•å¯¼ä¿¡æ¯ï¼Œå°¤å…¶æ˜¯nfsrootåçš„å‚æ•°è¯·ä¿®æ”¹ä¸ºè‡ªå·±çš„NFSæœåŠ¡å™¨

PROMPT 0
TIIMEOUT 0 #è¶…æ—¶é›¶ç§’ï¼Œä¼šè‡ªåŠ¨å¯åŠ¨é»˜è®¤å¯åŠ¨

</code></pre>
<p>ä¿å­˜è®¾ç½®ï¼Œä½¿ç”¨è™šæ‹Ÿæœºæµ‹è¯•ï¼Œæ— é—®é¢˜åå¯åŠ¨å®ä½“æœºï¼Œå¤§åŠŸå‘Šæˆ</p>
<h2 id="ç»“è¯­">ç»“è¯­</h2>
<p>è¿™æ ·ä¸€ä¸ªç®€å•çš„ç½‘ç»œå¯åŠ¨æŠ˜è…¾äº†è‡ªå·±å¾ˆä¹…ï¼Œç½‘ç»œä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½éœ€è¦è‡ªè¡Œç¼–è¯‘Linuxå†…æ ¸ï¼Œè¿™ç¯‡æ•™ç¨‹æ˜¯è‡ªå·±æŒ‰ç€ipxeçš„ä¸€äº›æ–‡æ¡£ä»¥åŠaskubuntuç¤¾åŒºçš„éƒ¨åˆ†é—®ç­”è€Œæˆçš„</p>
<p>å› ä¸ºç½‘ç»œå¯åŠ¨Linuxè¿™ä¸€éœ€æ±‚è¾ƒä¸ºç‰¹æ®Šï¼Œå›½å†…æ›´å¤šæ˜¯éƒ¨ç½²åªè¯»æ— ç›˜ç„¶åç”¨æ¥Centosè‡ªåŠ¨åŒ–å®‰è£…çš„ï¼Œå› æ­¤å†™äº†è¿™æ ·ä¸€ç¯‡æ•™ç¨‹ï¼Œå¸Œæœ›èƒ½å¸®åˆ°å„ä½ã€‚</p>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E5%89%8D%E8%A8%80">å‰è¨€</a></li>
<li><a href="#%E5%87%86%E5%A4%87">å‡†å¤‡</a></li>
<li><a href="#%E5%BC%80%E5%A7%8B%E9%83%A8%E7%BD%B2">å¼€å§‹éƒ¨ç½²</a>
<ul>
<li><a href="#%E5%87%86%E5%A4%87%E6%97%A0%E7%9B%98%E7%B3%BB%E7%BB%9F">å‡†å¤‡æ— ç›˜ç³»ç»Ÿ</a></li>
<li><a href="#%E5%90%AF%E7%94%A8%E7%BE%A4%E6%99%96iscsi%E5%8A%9F%E8%83%BD%E5%B9%B6%E6%8C%82%E8%BD%BDiscsi%E8%BF%9C%E7%A8%8B%E7%A3%81%E7%9B%98">å¯ç”¨ç¾¤æ™–iSCSIåŠŸèƒ½å¹¶æŒ‚è½½iSCSIè¿œç¨‹ç£ç›˜</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E7%B3%BB%E7%BB%9F%E6%96%87%E4%BB%B6">åˆ›å»ºç³»ç»Ÿæ–‡ä»¶</a></li>
<li><a href="#%E5%87%86%E5%A4%87nfs%E6%9C%8D%E5%8A%A1%E5%99%A8">å‡†å¤‡NFSæœåŠ¡å™¨</a></li>
<li><a href="#%E5%87%86%E5%A4%87dhcp%E6%9C%8D%E5%8A%A1%E5%99%A8">å‡†å¤‡DHCPæœåŠ¡å™¨</a></li>
</ul>
</li>
<li><a href="#%E7%BB%93%E8%AF%AD">ç»“è¯­</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">

	  
		<div id="gitalk-container"></div>
		<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/qyxtim/Static@3.8/gitalk.min.js"></script><link href="https://cdn.jsdelivr.net/npm/gitalk@1.5.0/dist/gitalk.css"rel="stylesheet"><script>var gitalk=new Gitalk({clientID:"4c865eb993fd790af259",clientSecret:"e48e16b1a5140b62ae29dc717ed9f983061a47fd",repo:"creeper23456.github.io",owner:"Creeper23456",admin:["Creeper23456"],proxy: 'https://api.cnklp.cn/login/oauth/access_token',id:(location.pathname).substring(0, 49),distractionFreeMode:false});gitalk.render("gitalk-container");</script>
	  
		  
	  

</div></section>
</div></div></div><script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
</script>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"><a href="https://github.com/Creeper23456/"title="github"><i class="iconfont icon-github"></i></a><a href="Creeper23456@icloud.com"title="envelope"><i class="iconfont icon-envelope"></i></a></div></div><div class="copyright"id="copyright">Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>Copyright Â© 2018-2020 <a href="https://blog.cnklp.cn" style="margin:0;">Creeper&#39;s blog</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_uv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>19</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://blog.cnklp.cn/media/js/prism.js"></script>
</body>
</html>